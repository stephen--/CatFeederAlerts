# Cat Feeder Alerts
I suspected my <a href="https://www.amazon.com/gp/product/B01M6UC8ZZ/">Automatic cat feader</a> occassionally failed to dispense scheduled meals. In order to try to prove my suspicions I first set up a <a href="https://www.amazon.com/gp/product/B016F3M7OM/">motion activated web cam</a>, but found the motion detect wasn't always reliable.

A webcam wasn't the way - I needed to measure actual meal dispensing, there must be a better way. I thought of a few ways...
<ul>
  <li>Adding a scale to the machine and logging weight changes (still a very reliable method IMO).</li>
  <li>Adding a motion sensor to the front of the machine (not a great method at all)</li>
  <li>Adding a sensor to the motor which dispenses the meals (<b>Bingo!</b>)</li>
</ul>

That last option seemed like a winner - the motor has a few criteria which made it a good candidate:
<ul>
  <li>It has a measurable current change</li>
  <li>It only activates when a meal is being dispensed</li>
</ul>
On the down side, a turning motor does not guarantee a meal. I would have to keep an eye out for the food level - but I do that now anyway.
<br/><br/>
The solution is an automatic monitoring system using nothing more than a $15 Smartthings sensor and a super cheap photo coupler. It sends email and text notifications if a meal is missed.

<H1>Wiring The Sensor</H1>
I purchased a <a href="https://www.amazon.com/gp/product/B06XDJ3KYC/">Visonic MCT-343 E</a>, I have already worked with these before so I knew I could simply solder wires to the points A & B.
<br/>

<center>
<br/><br/><a href="IMG_5704.jpg?raw=true"><img src="IMG_5704.jpg?raw=true" width="500" height="500" border="0"/></a><br/><i><b>Note:</b> Simply slide the battery cover off and pry the top cover off with your thumb (this can be done safely) in order to access the circuit board</i><br/><br/>
</center>

Having testing and measured the voltage running to the motor when activated, I knew it was operating around 5 volts. Thanks to the kindly help of internet strangers (<a href="https://www.reddit.com/r/AskElectronics/comments/72hgi7/photo_coupler_noob/">exibit A</a>) I was able to get a <a href="https://www.amazon.com/gp/product/B00S4YRMB4/">photo coupler</a> working.

That almost felt too easy! To round things out I added a <a href="https://www.amazon.com/gp/product/B01L6GUH2W/">2xAA battery pack</a> to my MCT-343 E to keep it going longer. 

<H1>Building the Monitoring System</H1>
Next up was the logic. I used a IFTTT recipe to log all events from the MCT-343 E on Smartthings to a Google Sheet with a timestamp. Again, feels too easy. 
<br/><br/>
Okay, so I'm logging dispensed meals - I could check multiple times every day but that's stupid. <i>Now</i> I need some logic. Thankfully Google makes this ridiculously easy with their "<a href="https://www.google.com/script/start/">App Scripts</a>".

In the Google Sheet which my IFTTT recipe created I added a second sheet titled "Errors". The following code will automatically insert missed meal entries in "Errors" and send email / text notifications.

In order to accomplish this I created a script on the Google Sheet generated by IFTTT, the full script is included <a href="/stephen--/CatFeederAlerts/blob/master/googleScript.js">here</a> (make sure to customize "yourEmail" and "yourTextEmail"). To use this you're going to have to add a Trigger, more specifically, a "Time Interval" (you can learn more about that <a href="https://developers.google.com/apps-script/guides/triggers/installable#managing_triggers_manually">here</a>).

<i><H1>Note</H1></i>
I know my script is going to draw some ire; it's not <i>beautiful</i> some may say. Others may point out how it's not <i>efficient</i>, and could be done another way. Well... it's easy to read and easy to follow for someone who is relatively new to coding so I think it's pretty darn nice. And most importantly - it got the job done!

<H1>Cat Tax</1>
<center>
<br/><br/><a href="https://raw.githubusercontent.com/stephen--/CatFeederAlerts/master/jazz.JPG"><img src="https://raw.githubusercontent.com/stephen--/CatFeederAlerts/master/jazz.JPG" width="500" height="375" border="0"/></a><br/><i>Jazz</i><br/><br/>
</center>
